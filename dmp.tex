\documentclass[12pt,a4paper]{report}
\usepackage[utf8]{inputenc}
\usepackage[czech]{babel}
\usepackage[T1]{fontenc}

% radkovani 1,5, ale ne u footnotes, literatury, ...
% baselinestretch 1.3 je radkovani 1,5
% https://theses.cz/id/say3ul/BP.pdf
% http://mirrors.nic.cz/tex-archive/info/czech/latex-pro-pragmatiky/latex-pro-pragmatiky.pdf
%\renewcommand{\baselinestretch}{1.3}
% To by bylo i v caption apod.
% https://texfaq.org/FAQ-linespace
\usepackage[onehalfspacing]{setspace}

%\usepackage[a4paper]{geometry}
% TODO predepsane okraje
\usepackage[
    a4paper,
    left=40mm,
    right=15mm,
    top=25mm,
    bottom=30mm,
    % includefoot ??
    marginparwidth=35mm,
    marginparsep=3mm,
    %showframe,
]{geometry}
\usepackage{array}
%\usepackage{multirow}
\usepackage{siunitx}
\usepackage{graphicx}
\usepackage{booktabs}
%\usepackage{calc} % e.g. for calculations in desky-predni
%\usepackage{refcount} % calculations with references (Lastpage in desky-predni)
%\usepackage{makecell} % for multiline cells in desky-predni
%\usepackage{lastpage}

%\usepackage{fancyhdr}

\usepackage{titling}
%\usepackage{tabularx}
%\usepackage{colortbl}
%\usepackage{hhline}
\usepackage{float}
\usepackage{csquotes}
\usepackage[backend=biber,style=iso-numeric]{biblatex}
\addbibresource{reference.bib}
\usepackage[czech]{varioref}
\usepackage[unicode,hidelinks]{hyperref}
\usepackage{pdflscape}
\usepackage{amsmath}
%\usepackage{wrapfig}
\usepackage{caption}
\usepackage{subcaption}
%\usepackage{catchfile}
\usepackage[
    %section
]{placeins} % provides \FloatBarrier
\usepackage[EFvoltages,siunitx,european, american inductors]{circuitikz}

\usepackage{enumitem}
\usepackage{listings}
\usepackage[htt]{hyphenat}  % hyphenate \texttt
\usepackage{titlesec}
\usepackage{acronym}
\usepackage[titles]{tocloft}
\usepackage[
    %disable
    % todonotes can do weird stuff with circuitikz/tikz node[above], even when
    % disabled
]{todonotes}
\reversemarginpar
\usepackage{dirtree}

%\usepackage{arydshln} % dashed lines in tabular; should be one of the last packages (http://texdoc.net/texmf-dist/doc/latex/arydshln/arydshln-man.pdf)

\graphicspath{{figures/}{sim/}} % figures and gnuplot EPS stuff


% TODO patching babel failed
\makeatletter
\newcommand\my@hyphen{-}
\patchcmd\select@language{-}{\my@hyphen }{}{\fail}
\makeatother


% http://www.gnuplotting.org/labels-with-white-background-in-latex-terminals/
\newcommand{\hl}[1]{\setlength{\fboxsep}{0.75pt}\colorbox{white}{#1}}

% robust command because of \listoffigures
\DeclareRobustCommand{\HAentity}[1]{\texttt{\detokenize{#1}}}  % detokenize makes underscores printable
\DeclareRobustCommand{\HAdomain}[1]{\texttt{\detokenize{#1}}}
\DeclareRobustCommand{\shellcmd}[1]{\texttt{\detokenize{#1}}}
\newcommand{\HAstate}{\texttt}
\DeclareRobustCommand{\topic}[1]{\texttt{\detokenize{#1}}}
\newcommand{\gitrepo}{\texttt}
\DeclareRobustCommand{\repopath}[1]{\texttt{\detokenize{#1}}}
\newcommand{\filename}{\texttt}
\DeclareRobustCommand{\yamlkey}[1]{\texttt{\detokenize{#1}}}
\DeclareRobustCommand{\inikey}[1]{\texttt{\detokenize{#1}}}

\title{Chytrý budík}
\author{Ondřej Sluka}
\date{2022}  % TODO

\frenchspacing
\sisetup{
    output-decimal-marker = {,},
    list-separator = {; },
    list-final-separator = { a~},
    list-pair-separator = { a~},
    group-digits,
    group-minimum-digits=4,
    range-phrase=\text{--},
    range-units=single,
    exponent-product=\ensuremath{\cdot}
}

\DeclareSIUnit{\sample}{Sa}

% https://tex.stackexchange.com/questions/55802/latex-lstinline
\newcommand{\mysinglespacing}{%
  \setstretch{1}% no correction afterwards
}

% https://tex.stackexchange.com/questions/30512/how-to-insert-code-with-accents-with-listings
\lstset{
  basicstyle=\mysinglespacing,
  columns=flexible,
  frame=single,
  breaklines=true,
  postbreak=\mbox{\textcolor{red}{$\hookrightarrow$}\space},
  literate=%
    {á}{{\'a}}1
    {í}{{\'i}}1
    {é}{{\'e}}1
    {ý}{{\'y}}1
    {ú}{{\'u}}1
    {ó}{{\'o}}1
    {ě}{{\v{e}}}1
    {š}{{\v{s}}}1
    {č}{{\v{c}}}1
    {ř}{{\v{r}}}1
    {ž}{{\v{z}}}1
    {ď}{{\v{d}}}1
    {ť}{{\v{t}}}1
    {ň}{{\v{n}}}1
    {ů}{{\r{u}}}1
    {Á}{{\'A}}1
    {Í}{{\'I}}1
    {É}{{\'E}}1
    {Ý}{{\'Y}}1
    {Ú}{{\'U}}1
    {Ó}{{\'O}}1
    {Ě}{{\v{E}}}1
    {Š}{{\v{S}}}1
    {Č}{{\v{C}}}1
    {Ř}{{\v{R}}}1
    {Ž}{{\v{Z}}}1
    {Ď}{{\v{D}}}1
    {Ť}{{\v{T}}}1
    {Ň}{{\v{N}}}1
    {Ů}{{\r{U}}}1
}
  %literate={█}{{\#}}1

\lstdefinestyle{numbers}
    { numbers=left, xleftmargin=2em, %
      %framexleftmargin=1.5em,  % cisla radku uvnitr ramecku, vypada hnusne
    }

\lstdefinestyle{terminal}
    {basicstyle=\ttfamily\mysinglespacing,basewidth={0.5em,0.5em}}


\lstdefinelanguage{Ini}
{
    basicstyle=\ttfamily\mysinglespacing,
    morecomment=[s][\rmfamily\bfseries]{[}{]},
    morecomment=[l]{\#},
    morecomment=[l]{;},
    commentstyle=\rmfamily\itshape,
    morekeywords={},
}

\lstdefinelanguage{yaml}
{
    columns=[l]flexible,
    %
    morekeywords={%
        true,false,null,
        !secret,!include,!include_dir_list,!include_dir_named,
        !include_dir_merge_list,!include_dir_merge_named
    },
    alsoletter={!},
    sensitive=false,
    %
    comment=[l]{\#},
    commentstyle=\mdseries\rmfamily\itshape,
    %
    morestring=[d]',
    morestring=[b]",
    %stringstyle=\mdseries\ttfamily\itshape,  % only for testing
    showstringspaces = false,
    % multiline strings >- -- looks too hard to implement
    %
    %moredelim=[l][\color{orange}]{\&},
    %moredelim=[l][\color{magenta}]{*},
    %
    % TODO YAML syntax highlighting - \bfseries keys not compatible with multiline strings
    %basicstyle=\bfseries\mysinglespacing,
    %moredelim=**[il][\mdseries{:}]{:}, % switch to value style at :
    %moredelim=[l][\mdseries]{:}, % switch to value style at :
    %
    % alsolanguage jinja2 -- too complicated
    %
    literate =  {---}{{\llap{\mdseries-{-}-}}}3
                {>}{{\textgreater}}1
                {>-}{{\textgreater-}}2
                {|}{{\textbar}}1
                {|-}{{\textbar-}}2
                {-\ }{{\mdseries-\ }}2,
}

\lstdefinelanguage{Poke}
{
    sensitive=true,
    % see poke.vim in poke 2.1
    morekeywords={%
        % statement
        assert,break,continue,return,
        type,unit,fun,method,
        var,
        % operators
        in,sizeof,as,isa,unmap,
        % conditionals
        if,else,where,
        %
        struct,union,pinned,
        % loops
        while,for,
        % imports
        load,
        try,catch,until,raise,
        % exceptions - skipped
        % types
        string,void,int,uint,bit,nibble,
        byte,char,ushort,short,ulong,long,
        uint8,uint16,uint32,uint64,
        off64,uoff64,offset,
        Comparator,POSIX_Time32,POSIX_Time64,
        big,little,any,
        % constants
        ENDIAN_LITTLE,ENDIAN_BIG,
        IOS_F_READ,IOS_F_WRITE,IOS_F_CREATE,
        IOS_M_RDONLY,IOS_M_WRONLY,IOS_M_RDWR,
        load_path,NULL,OFFSET,
        % Poke std lib
        print,printf,catos,stoca,atoi,ltos,reverse,
        ltrim,rtrim,strchr,qsort,crc32,alignto,
        open,close,flush,get_ios,set_ios,iosize,
        rand,get_endian,set_endian,strace,exit,
        getenv,
        % integer literals - skipped
        % Units
        b,M,B,
        Kb,KB,Mb,MB,Gb,GB,
        Kib,KiB,Mib,MiB,Gib,GiB,
        % offsets - skipped
    },
    morecomment=[s]{/*}{*/},
    morecomment=[l]//,
    morestring=[b]",
    moredelim=[s][keywordstyle]{<}{>}  % uint<x>
}


% fancyhdr does not seem to work well with documentclass report
% headers and footers
%\setlength{\headheight}{15pt} % prevents a warning most likely caused by diacritics
%\pagestyle{fancy}
%%\renewcommand{\headrulewidth}{0pt}
%\fancyhf{} % clears header and footer, otherwise "plain" will appear
%%\fancyhead{} % only clears the header
%\lhead{\theauthor}
%\rhead{\thepage}
%\fancyhfoffset{0pt} % fixes width after \newgeometry

% Roztrhana matika
\allowdisplaybreaks

% kapitola bez cisla
\newcommand{\nonuchapter}[1]
{%
    \chapter*{#1}%
    \addcontentsline{toc}{chapter}{#1}% v toc, ale bez cisla
    \phantomsection%
}

% seznam priloh
% https://tex.stackexchange.com/questions/26732/how-to-get-a-list-of-appendices
\newcommand{\listappendicesname}{Seznam příloh}
\newlistof{appendices}{apc}{\listappendicesname}
\renewcommand{\theappendices}{\Alph{appendices}}
\newcommand{\newappendix}[1]{%
    \refstepcounter{appendices}
    \section*{Příloha \theappendices: #1}
    \phantomsection
    \addcontentsline{apc}{appendices}{\protect\numberline{\theappendices}#1}
}



\begin{document}
\input{titlepage}
\todo[inline]{zadani}
\clearpage
\input{anotace}
\vfill
\input{prohlaseni}

\tableofcontents

\input{uvod}
\chapter{Hardware a firmware}
\input{MCU}
\input{platformio}
\input{GUI}
\input{zvuk}
\input{ambient}
\chapter{Software}
\todo[inline]{Uvod - cemu rikam software a cemu firmware}
\input{PyAlarmClock}
\input{HomeAssistant}

% Reference a odkazy
{\singlespacing%
\printbibliography[title={Odkazy a~literatura}]
\todo[inline]{poznamky a odkazy ??}
\phantomsection
\addcontentsline{toc}{chapter}{Odkazy a~literatura}  % v toc, ale bez cisla
\todo{abecedni razeni seznamu literatury}
}

\listoffigures
\phantomsection
\addcontentsline{toc}{chapter}{\listfigurename}  % v toc, ale bez cisla

\listoftables
\phantomsection
\addcontentsline{toc}{chapter}{\listtablename}  % v toc, ale bez cisla


\nonuchapter{Seznam zkratek}
% POZOR podle abecedy to musim radit rucne...
% vim select in visual mode & :sort
\begin{acronym}[EEPROM] % nejdelsi zkratka kvuli zarovnani
    \acro{CLI}{příkazový řádek\acroextra{ (\foreignlanguage{english}{command line interface})}}
    \acro{EEPROM}{elektricky vymazatelná paměť pouze pro čtení\acroextra{ (\foreignlanguage{english}{electrically erasable programmable read-only memory})}}
    \acro{IDE}{vývojové prostředí\acroextra{ (\foreignlanguage{english}{integrated development environment})}}
    \acro{ISR}{obsluha přerušení\acroextra{ (\foreignlanguage{english}{interrupt service routine})}}
    \acro{LED}{elektroluminiscenční dioda\acroextra{ (\foreignlanguage{english}{light-emitting diode})}}
    \acro{LSB}{nejméně významný bit\acroextra{ (\foreignlanguage{english}{least significant bit})}}
    \acro{LUT}{vyhledávací tabulka\acroextra{ (\foreignlanguage{english}{lookup table})}}
    \acro{LWT}{\foreignlanguage{english}{Last Will and Testament}\acroextra{ (funkce protokolu MQTT)}}
    \acro{MCU}{mikrokontrolér\acroextra{ (jednočipový počítač; \foreignlanguage{english}{microcontroller unit})}}
    \acro{MSB}{nejvýznamnější bit\acroextra{ (\foreignlanguage{english}{most significant bit})}}
    \acro{PWM}{pulzně šířková modulace\acroextra{ (\foreignlanguage{english}{pulse-width modulation})}}
    \acro{RTC}{hodiny reálného času\acroextra{ (\foreignlanguage{english}{real-time clock})}}
    \acro{SDK}{software development kit}
    \acro{SMD}{součástka pro povrchovou montáž\acroextra{ (\foreignlanguage{english}{surface mount device})}}
    \acro{SRAM}{statická polovodičová pamět s~přímým přístupem\acroextra{ (\foreignlanguage{english}{static random-access memory})}}
    % TODO \acro{MQTT}{} ??
    % TODO \acro{UART}{} ??
    % TODO \acro{CC}{} ?? constant current
    % TODO \acro{CV}{} ?? constant voltage
\end{acronym}


\listoftodos


\listofappendices
\addcontentsline{toc}{chapter}{\listappendicesname}

\include{prilohy}

\end{document}
